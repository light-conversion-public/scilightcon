import pytest
import numpy as np

def test_interpolate_and_multiply():
    from scilightcon.utils import interpolate_and_multiply

    D1 = np.array([[0.00000000e+00, 1.11089965e-02],
       [2.50000000e+01, 2.27941809e-02],
       [5.00000000e+01, 4.39369336e-02],
       [7.50000000e+01, 7.95595087e-02],
       [1.00000000e+02, 1.35335283e-01],
       [1.25000000e+02, 2.16265167e-01],
       [1.50000000e+02, 3.24652467e-01],
       [1.75000000e+02, 4.57833362e-01],
       [2.00000000e+02, 6.06530660e-01],
       [2.25000000e+02, 7.54839602e-01],
       [2.50000000e+02, 8.82496903e-01],
       [2.75000000e+02, 9.69233234e-01],
       [3.00000000e+02, 1.00000000e+00],
       [3.25000000e+02, 9.69233234e-01],
       [3.50000000e+02, 8.82496903e-01],
       [3.75000000e+02, 7.54839602e-01],
       [4.00000000e+02, 6.06530660e-01],
       [4.25000000e+02, 4.57833362e-01],
       [4.50000000e+02, 3.24652467e-01],
       [4.75000000e+02, 2.16265167e-01],
       [5.00000000e+02, 1.35335283e-01],
       [5.25000000e+02, 7.95595087e-02],
       [5.50000000e+02, 4.39369336e-02],
       [5.75000000e+02, 2.27941809e-02],
       [6.00000000e+02, 1.11089965e-02],
       [6.25000000e+02, 5.08606923e-03],
       [6.50000000e+02, 2.18749112e-03],
       [6.75000000e+02, 8.83826307e-04],
       [7.00000000e+02, 3.35462628e-04],
       [7.25000000e+02, 1.19612884e-04],
       [7.50000000e+02, 4.00652974e-05],
       [7.75000000e+02, 1.26071052e-05],
       [8.00000000e+02, 3.72665317e-06],
       [8.25000000e+02, 1.03485421e-06],
       [8.50000000e+02, 2.69957850e-07],
       [8.75000000e+02, 6.61560164e-08],
       [9.00000000e+02, 1.52299797e-08],
       [9.25000000e+02, 3.29371411e-09],
       [9.50000000e+02, 6.69158609e-10],
       [9.75000000e+02, 1.27711155e-10]])
    
    D2 = np.array([[2.00000000e+02, 1.12535175e-07],
       [2.50000000e+02, 4.78511739e-06],
       [3.00000000e+02, 1.23409804e-04],
       [3.50000000e+02, 1.93045414e-03],
       [4.00000000e+02, 1.83156389e-02],
       [4.50000000e+02, 1.05399225e-01],
       [5.00000000e+02, 3.67879441e-01],
       [5.50000000e+02, 7.78800783e-01],
       [6.00000000e+02, 1.00000000e+00],
       [6.50000000e+02, 7.78800783e-01],
       [7.00000000e+02, 3.67879441e-01],
       [7.50000000e+02, 1.05399225e-01],
       [8.00000000e+02, 1.83156389e-02],
       [8.50000000e+02, 1.93045414e-03],
       [9.00000000e+02, 1.23409804e-04],
       [9.50000000e+02, 4.78511739e-06]])
    
    result = (interpolate_and_multiply(D1, D2) - np.array([[2.00000000e+02, 6.82560338e-08],
       [2.25000000e+02, 1.84847106e-06],
       [2.50000000e+02, 4.22285128e-06],
       [2.75000000e+02, 6.21253892e-05],
       [3.00000000e+02, 1.23409804e-04],
       [3.25000000e+02, 9.95336595e-04],
       [3.50000000e+02, 1.70361980e-03],
       [3.75000000e+02, 7.64127640e-03],
       [4.00000000e+02, 1.11089965e-02],
       [4.25000000e+02, 2.83203959e-02],
       [4.50000000e+02, 3.42181183e-02],
       [4.75000000e+02, 5.11768448e-02],
       [5.00000000e+02, 4.97870684e-02],
       [5.25000000e+02, 4.56146576e-02],
       [5.50000000e+02, 3.42181183e-02],
       [5.75000000e+02, 2.02731534e-02],
       [6.00000000e+02, 1.11089965e-02],
       [6.25000000e+02, 4.52355197e-03],
       [6.50000000e+02, 1.70361980e-03],
       [6.75000000e+02, 5.06733074e-04],
       [7.00000000e+02, 1.23409804e-04],
       [7.25000000e+02, 2.83051130e-05],
       [7.50000000e+02, 4.22285128e-06],
       [7.75000000e+02, 7.79843148e-07],
       [8.00000000e+02, 6.82560338e-08],
       [8.25000000e+02, 1.04758773e-08],
       [8.50000000e+02, 5.21141249e-10],
       [8.75000000e+02, 6.79377282e-11],
       [9.00000000e+02, 1.87952882e-12],
       [9.25000000e+02, 2.11118711e-13],
       [9.50000000e+02, 3.20200250e-15]]))
    
    assert (np.shape(result) == (31, 2))
    assert (np.sum(np.abs(np.array(result[:,1]))) < 1.0e-8)
